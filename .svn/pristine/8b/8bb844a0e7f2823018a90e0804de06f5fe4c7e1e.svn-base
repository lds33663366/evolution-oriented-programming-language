package structure;
import java.io.Serializable;
import java.util.Date;
import java.util.List;

public class Message implements Cloneable, Serializable{
	private String name; // Message的名字
	private Date date; // 发送时间
	private String from; // 发关此Message的Instance名字
	private int frequency; // 发送次数
	private String life; // 生存时间
	private int priority; // 优先级
	private int second; // Message将于多长时间后发送
	private int share; // 可接收此Message的instance的最大数量
	private static int ID = 0;
	private int id;
	private String topic; //消息主题，如果没有则为null
	
	private List<MessageContent> contentList;

	public Message(String name, Date date, String from, int priority, int frequency, String life,
			int second, int share, List<MessageContent> contentList) {
		this.date = date;
		this.frequency = frequency;
		this.from = from;
		this.life = life;
		this.name = name;
		this.priority = priority;
		this.second = second;
		this.share = share;
		this.contentList = contentList;
		
		this.id = ID++;
	}

	public Message clone() {
		Message o = null;
		try {
			o = (Message) super.clone();
	//		o.id = ID++;
		} catch (CloneNotSupportedException e) {
			e.printStackTrace();
		}
		return o;
	}
	
	public int getId() {
		return id;
	}

	public Date getDate() {
		return date;
	}

	public int getFrequency() {
		return frequency;
	}

	public String getFrom() {
		return from;
	}

	public String getLife() {
		return life;
	}

	public String getName() {
		return name;
	}

	public int getPriority() {
		return priority;
	}

	public int getSecond() {
		return second;
	}

	public int getShare() {
		return share;
	}

	public void setDate(Date date) {
		this.date = date;
	}

	public void setFrequency(int frequency) {
		this.frequency = frequency;
	}

	public void setFrom(String from) {
		this.from = from;
	}

	public void setLife(String life) {
		this.life = life;
	}

	public void setName(String name) {
		this.name = name;
	}

	public void setPriority(int priority) {
		this.priority = priority;
	}

	public void setSecond(int second) {
		this.second = second;
	}

	public void setShare(int share) {
		this.share = share;
	}
	

	public String getTopic() {
		return topic;
	}

	public void setTopic(String topic) {
		this.topic = topic;
	}
	
	

	public List<MessageContent> getContentList() {
		return contentList;
	}

	public void setContentList(List<MessageContent> contentList) {
		this.contentList = contentList;
	}

	@Override
	public String toString() {
		StringBuffer sb = new StringBuffer();
		sb.append("Message "+id + " [name=" + name + ", date=" + date + ", from=" + from
				+ ", frequency=" + frequency + ", life=" + life + ", priority="
				+ priority + ", second=" + second + ", share=" + share + "]") ;
		if (contentList != null && contentList.size()>0) {
			sb.append("\n");
			for (MessageContent mc : contentList) {
				sb.append(mc + "\t");
			}
		}
		
		return sb.toString();
	}
	
	public long parseLife() {
		
		String sign = life.trim().substring(life.length()-1);
		long l = Long.parseLong(life.trim().substring(0, life.length()-1));
		
		switch(sign) {
		case "s":
			return l;
		case "m":
			return l * 60;
		case "h":
			return l * 3600;
		case "d":
			return l * 3600 * 24;
		default:
			throw new RuntimeException("不合法的life属性");
		}
		
	}

	@Override
	public boolean equals(Object arg0) {
		
		Message m = (Message)arg0;
		if (this.getName().equals(m.getName()) 
				&&this.getFrom().equals(m.getFrom())
				&&this.getDate().equals(m.getDate()))
			return true;
		return super.equals(arg0);
	}

	@Override
	public int hashCode() {
		return name.hashCode();
	}
}
